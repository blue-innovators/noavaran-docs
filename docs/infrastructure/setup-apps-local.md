# اجرای نرم‌افزارهای شرکت بصورت لوکال
در این قسمت به صورت قدم به قدم نرم افزارهای موجود در شرکت را بصورت لوکال بر روی یک کامپیوتر راه اندازی میکنیم. این امکان به توسعه دهندگان اجازه می‌دهد تا دیپندنسی خود به هر کدام از سرورها جهت دریافت سرویس مد نظر را حذف کنند.

## پیش نیازها
برای راه اندازی نرم‌افزار‌های شرکت بصورت لوکال شما به یک سیستم که مشخصات زیر را داشته باشد نیاز دارید:

* بر روی آن داکر نصب شده باشد
* بر روی آن گیت نصب شده باشد
* ادیتور متنی داشته باشد
* به اینترنت دسترسی داشته باشد
* فضایی که داکر درآن نصب شده است حداقل 30 گیگ ظرفیت خالی داشته باشد
* رم سیستم حداقل 8 گیگ باشد

## راه اندازی برای بار اول
راه اندازی نرم افزارهای شرکت بصورت لوکال تفاوت‌هایی با دفعات بعدی دارد. اما علت این تفاوت چیست؟

* احراز هویت ریپازیتوری‌های داکر
* نصب کردن certificate مورد نیاز برای راه اندازی ssl لوکال
* ساخت network مورد نیاز container ها
* ایجاد فایل env
* ایجاد دیتابیس‌های سرویس زیرساخت
* درج دیتای کیف پول‌های مورد نیاز جهت پرداخت
* آپلود عکس‌های مورد نیاز در سرور استاتیک لوکال

این‌ها تمامی کارهایی هستند که در دفعات بعدی نیازی به انجام آن‌ها نمی‌باشد. در ادامه تمامی موارد را با هم بررسی میکنیم.

برای راه اندازی نرم افزارهای شرکت بصورت لوکال به ترتیب زیر عمل میکنیم : 

### 1. Clone کردن پروژه Docker Deploy
در ابتدا یک پوشه برای گرفتن سورس کد پروژه docker deploy ایجاد میکنیم. سپس از آدرس زیر پروژه را در پوشه ایجاد شده clone نمایید:
```
http://tfs.bidev.ir/DefaultCollection/Deployment/_git/deploy-docker
```

### 2. Checkout کردن به برنچ local-dev
برای استفاده از این سورس کد به منظور راه اندازی سرویس‌ها به صورت لوکال به برنچ local-dev بروید.

### 3. نصب کردن فایل certificate
برای راه اندازی ارتباط ssl بصورت لوکال لازم است که یک certificate را بر روی سیستم خود trust کنید. فایل نصب certificate مربوطه در سورس کد پروژه گذاشته شده است. به این شکل :

![Install Certificate](/assets/images/install-certificate.png)

نکته حائز اهمیت در نصب این certificate قرار دادن آن در Trusted root authorities می باشد.

### 4. ساخت فایل .env
در سورس کد یک فایل .env.sample گذاشته شده است. آن را کپی کرده و نامش را به .env تغییر دهید.

### 5. اضافه کردن دامین‌های مورد نیاز به فایل host
حال لازم است که در فایل host سیستم تمامی دامین‌های مورد نیاز را وارد کنیم تا بتوانیم آدرس های مورد نیازمان را بصورت لوکال در مرورگر سیستم خود ببینیم
آدرس ها را به شکل زیر تماماً به IP لوکال مپ میکنیم:

```
127.0.0.1	static.local.dev
127.0.0.1	demo.local.dev
127.0.0.1	admin.local.dev
127.0.0.1	parsa.local.dev
127.0.0.1	auth.local.dev
127.0.0.1	payment.local.dev
127.0.0.1	credits.local.dev
127.0.0.1	market.local.dev
127.0.0.1	restora.local.dev
```

### 6. لاگین کردن روی ریپازیتوری‌های dcr و dreg داکر
 قدم بعدی لاگین کردن برای دسترسی داشتن به ریپازیتوری‌های داخلی داکر شرکت می‌باشد. برای منظور در terminal سیستم خود دو دستور زیر را اجرا کنید :

```
docker login dcr.bidev.ir -u developer -p 123
docker login dreg.bidev.ir -u developer -p 123
```

### 7. ایجاد شبکه appnet
حال بایستی شبکه ای با نام appnet ایجاد کنیم زیرا که تمامی سرویس‌های ما بر روی این شبکه با یکدیگر در ارتباط خواهند بود. برای ایجاد این شبکه دستور زیر را در terminal اجرا نمایید :

```
docker network create --driver=bridge --subnet=192.168.254.0/26 --gateway=192.168.254.1 appnet
```

### 7. راه اندازی Infrastructure
خب حالا میخواهیم اولین سرویس‌های مورد نیازمان را راه اندازی کنیم. Infrastructure شامل تمامی سرویس های زیر ساختی میباشد که مورد استفاده نرم افزار داخلی شرکت می باشند. لیست سرویس به شکل زیر است:

* mssql
* seq
* rabittmq
* redis
* minio

برای اجرا این دستور ابتدا به مسیر root پروژه docker-deploy بروید و در آنجا terminal ر باز کرده و دستور زیر را اجرا نمایید :

```
docker-compose -f .\docker-compose.infrastructure.yml up -d
```

### 8. کمی صبر، اما چرا؟

### 9. این قسمت مربوط به mssql برای لینوکسی هاست - اگر ویندوزی هستید نخوانید 😁

### 10. آپلود کردن عکس‌های مورد نیاز در سرور minio

### 11. اجرای اسکریپت‌های ساخت دیتابیس‌های مورد نیاز سرویس‌های زیرساخت

### 12. راه اندازی Common

### 13. راه اندازی Gateway

### 14. ایجاد دیتای مورد نیاز برای wallet ها با api call

### 15. راه اندازی Parsa

### 16. راه اندازی Restora

## راه اندازی برای دفعات بعد
## توسعه در آینده ؟
