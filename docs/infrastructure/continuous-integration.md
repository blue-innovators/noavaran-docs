# سیستم بیلد
در این مستند نحوه پیاده سازی بیلد پروژه های شرکت توسط سرور بیلد و سرویسهای درون آن توضیح داده شده است. این مستند درباره سیستم Branching در git مربوط به پروژه ها نمیپردازد.

## سرور TFS (Azure DevOps)
این سرور وظیفه نگهداری کدهای پروژه ها را برعهده دارد. در این سرور یک نسخه از سیستم Azure DevOps نصب شده که تمامی کدها بهمراه دستورات Pipeline جهت بیلد پروژه ها در آن قرار گرفته اند. هر تیم نرم افزاری براساس روال های تصمیم گرفته درون تیمی خود کدهای نرم افزار را درون برنچ هایی تقسیم بندی کرده اند که به pipeline ها اجازه میدهد براساس هر برنچ مشخص کند چه زمانی، چه کدهایی برای بیلد ارسال شود. زمانی که دستور بیلد صادر شود، سرویسهایی بنام Azure DevOps Agent که در سرور بیلد قرار گرفته اند اجرا شده و کد مربوطه را جهت بیلد دریافت کرده و فرایند بیلد را آغاز میکند.

## سرور بیلد
![Continuous Integration Schema](/assets/images/continuous-integration-schema.png)
این سرور شامل چند سرویس است که هرکدام وظایفی در تمام فرایند بیلد عهده دار است:

* سرویس Nexus: این سرویس مجموعه ای از ریپازیتوری ها را شامل میشود که که چه به عنوان Cache برای پکیج های خارجی و Host برای پکیج های داخلی عمل میکند.
    - ریپازیتوری داکر: این ریپازیتوری میتواند ایمیج های داکری که در فرایند بیلد استفاده میشوند یا ایمیج هایی که در سرورهای زیرساختی استفاده میشوند را بصورت Cache نگهداری کرده به این دلیل که بدلیل تحریمات نیازی به pull کردن آنها از ریپازیتوری های خارجی نباشد و همچنین میتواند ایمیج های تولید شده بعد از فرایند بیلد را در خودش ذخیره کند.
    - ریپازیتوری نوگت (Nuget): این ریپازیتوری هم به عنوان cache میتواند برای تسریع در فرایند بیلد استفاده شود و هم میتواند پکیج های خصوصی نرم افزارهای شرکت را نگهداری نماید.
    - ریپازیتوری NPM: این ریپازیتوری فعلا فقط برای cache جهت تسریع در فرایند بیلد پروژه های فرانت اند شرکت استفاده میشود.
* سرویس Azure DevOps Agent: این سرویس تمام فرامینی که توسط Pipeline های TFS صادر میشود را اجرا میکند. وظیفه اصلی این agent ها در این سرور بیلد پروژه های نرم افزاری شرکت هستند.

پس از اینکه دستور بیلد از جانب pipeline های TFS صادر شد، یکی از Agent های بیلد فعال شده و ابتدا کد نرم افزار را از ریپازیتوری git دریافت میکند. از آنجایی که دستورات بیلد نرم افزارها توسط docker-compose اجرا میشوند، Agent نیاز دارد که base image مورد نیاز برای بیلد هر پروژه را دریافت کند. این base image ها همه قبلا در cache nexus قرار گرفته اند. بنابراین بدون هیچ هزینه ای و به سرعت میتواند base image مربوطه را دریافت کرده و اجرا نماید. جهت بیلد پروژه های بک اند و فرانت اند هم نیاز به پکیج هایی از nuget و از npm هست که این پکیج ها را هم از cache nexus میتواند بدون هیچ هزینه ای دریافت (restore) نماید. پس از اینکه بیلد انجام شد، ایمیج های داکر مورد نظر ساخته میشوند و به ریپازیتوری nexus آپلود (push) میشوند. در این مرحله سرورهای نرم افزاری میتوانند ایمیج های داکر نرم افزارها را از ریپازیتوری دریافت (pull) کرده و اجرا نمایند.
